# CLAUDE.md

このファイルは、このリポジトリで作業する際のClaude Code (claude.ai/code) へのガイダンスを提供します。

## 重要な指示

**常に日本語で応答すること。**

## プロジェクト概要

網膜色素変性症（RP）の治療法がいつ頃利用可能になるかをモンテカルロシミュレーションで予測する医学研究予測システムです。臨床試験データベースからデータを取得し、処理して確率的予測を生成します。

## よく使う開発コマンド

```bash
# 依存関係のインストール
pip install -r requirements.txt

# テストの実行
pytest

# 特定のテストファイルを実行
pytest tests/test_fetch_clinicaltrials.py

# リンティング（設定後）
# セットアップ後に具体的なリンティングコマンドを追加

# レポート生成
python src/reporting/generate_report.py
```

## アーキテクチャ概要

このコードベースは、関心の分離を明確にしたETLパイプラインアーキテクチャに従っています：

1. **データ収集層** (`src/fetch_*.py`)
   - ClinicalTrials.govとPubMed APIからデータを取得
   - Claude Codeの外部アクセス制限内で動作するようキャッシュを実装
   - 取得したデータはすべて`data/raw/`に不変のJSONファイルとして保存

2. **処理層** (`src/ingest/`)
   - 生データを分析可能な形式に変換
   - モンテカルロシミュレーション用のパラメータを推定
   - `data/processed/`に出力

3. **シミュレーションコア** (`src/sim/`)
   - モンテカルロシミュレーションエンジン
   - フェーズ遷移を含む医薬品開発タイムラインをモデル化
   - 不確実性の伝播を処理

4. **出力層** (`src/viz/` と `src/reporting/`)
   - 異なる対象者向けの可視化を生成
   - 複数の形式（技術者向け、患者向け、一般向け）で自動レポートを作成

## 実装上の重要な考慮事項

1. **外部APIアクセス**: Claude Codeの限定的な外部アクセスで動作するよう設計：
   - すべてのAPIレスポンスを`data/raw/`にローカルキャッシュ
   - 再ダウンロードを避けるため増分取得を使用
   - オフライン分析用に処理済みデータを保存

2. **Pythonバージョン**: SYSTEM.mdで指定されているPython 3.11を使用

3. **データの不変性**: `data/raw/`内のファイルは決して変更しない - これにより再現性を確保

4. **モンテカルロパラメータ**: 主要なシミュレーションパラメータは設定ファイルに保存し、バージョン管理する

5. **テスト戦略**: すべてのデータ処理とシミュレーションロジックには対応するテストが必要

## プロジェクト固有のコンテキスト

- 主な対象者：研究者、RP患者、一般市民
- 再現性と透明性を重視
- 結果はGitHub Pages経由で公開
- すべての可視化でアクセシビリティを考慮（色覚異常対応のパレット）
- レポートは異なる対象者向けに複数の形式で生成

## 開発ワークフロー

1. すべての変更は`develop`ブランチで作業
2. 実装順序はTASK_LIST.jsonのタスクリストに従う
3. すべてのデータ変換をコード化（手動ステップなし）
4. 外部依存関係やAPIキーが必要な場合は文書化
5. 変更をコミットする前にテストを実行

## 重要なファイル

- `TASK_LIST.json`: 詳細な実装ロードマップ
- `README.md`: 包括的なプロジェクト仕様と方法論
- `SYSTEM.md`: Claude Code操作手順